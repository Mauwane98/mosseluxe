<!DOCTYPE html>
<html>
<head>
    <title>Wishlist Browser Test</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        button { padding: 10px 20px; margin: 10px; font-size: 16px; }
        pre { background: #f5f5f5; padding: 15px; border: 1px solid #ddd; overflow-x: auto; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>Wishlist Endpoint Test</h1>
    
    <div>
        <button onclick="testCheck()">Test CHECK (GET)</button>
        <button onclick="testAdd()">Test ADD (POST)</button>
        <button onclick="clearLog()">Clear Log</button>
    </div>
    
    <h2>Results:</h2>
    <pre id="output">Click a button to test...</pre>

    <script>
        const output = document.getElementById('output');
        
        function log(message, isError = false) {
            const timestamp = new Date().toLocaleTimeString();
            const className = isError ? 'error' : 'success';
            output.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
        }
        
        function clearLog() {
            output.innerHTML = 'Log cleared.\n';
        }
        
        async function testCheck() {
            log('Testing CHECK action (GET)...');
            
            try {
                const url = 'wishlist_actions.php?action=check&product_id=1';
                log(`URL: ${url}`);
                
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                });
                
                log(`Status: ${response.status} ${response.statusText}`);
                log(`Content-Type: ${response.headers.get('content-type')}`);
                
                // Get raw text first
                const text = await response.text();
                log(`Response Length: ${text.length} bytes`);
                log(`First 200 chars: ${text.substring(0, 200)}`);
                
                // Show hex of first 50 bytes
                let hex = '';
                for (let i = 0; i < Math.min(50, text.length); i++) {
                    hex += text.charCodeAt(i).toString(16).padStart(2, '0') + ' ';
                }
                log(`Hex (first 50 bytes): ${hex}`);
                
                // Try to parse JSON
                try {
                    const json = JSON.parse(text);
                    log('✓ Valid JSON:', false);
                    log(JSON.stringify(json, null, 2));
                } catch (e) {
                    log(`✗ JSON Parse Error: ${e.message}`, true);
                    log(`Full response:\n${text}`, true);
                }
                
            } catch (error) {
                log(`✗ Fetch Error: ${error.message}`, true);
            }
            
            log('---\n');
        }
        
        async function testAdd() {
            log('Testing ADD action (POST)...');
            
            try {
                const formData = new FormData();
                formData.append('action', 'add');
                formData.append('product_id', '1');
                formData.append('csrf_token', window.csrfToken || 'test');
                
                const response = await fetch('wishlist_actions.php', {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                });
                
                log(`Status: ${response.status} ${response.statusText}`);
                log(`Content-Type: ${response.headers.get('content-type')}`);
                
                const text = await response.text();
                log(`Response Length: ${text.length} bytes`);
                log(`First 200 chars: ${text.substring(0, 200)}`);
                
                // Show hex of first 50 bytes
                let hex = '';
                for (let i = 0; i < Math.min(50, text.length); i++) {
                    hex += text.charCodeAt(i).toString(16).padStart(2, '0') + ' ';
                }
                log(`Hex (first 50 bytes): ${hex}`);
                
                try {
                    const json = JSON.parse(text);
                    log('✓ Valid JSON:', false);
                    log(JSON.stringify(json, null, 2));
                } catch (e) {
                    log(`✗ JSON Parse Error: ${e.message}`, true);
                    log(`Full response:\n${text}`, true);
                }
                
            } catch (error) {
                log(`✗ Fetch Error: ${error.message}`, true);
            }
            
            log('---\n');
        }
    </script>
</body>
</html>
